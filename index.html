<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Data Personel PAI 1B</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Reset & Base */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #022c22; /* Darker Green for better contrast */
            color: white;
            overflow: hidden; /* Prevent body scroll */
            height: 100dvh; /* Dynamic Height for Mobile Browsers */
            width: 100vw;
        }

        /* Container Utama Mobile-First */
        .app-container {
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Desktop Adjustment */
        @media (min-width: 768px) {
            body {
                display: flex;
                align-items: center;
                justify-content: center;
                background-image: radial-gradient(circle at 50% 50%, #065f46 0%, #022c22 100%);
            }
            .app-container {
                height: 90vh;
                max-width: 480px;
                border-radius: 24px;
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            }
        }

        /* Scrollbar Halus */
        .custom-scroll {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .custom-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        /* Glass Item List */
        .glass-item {
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s active;
        }
        .glass-item:active {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Status Styles */
        .status-indicator {
            width: 4px;
            height: 100%;
            position: absolute;
            left: 0;
            top: 0;
        }
        .status-hadir .status-indicator { background-color: #10b981; box-shadow: 0 0 10px #10b981; }
        .status-izin .status-indicator { background-color: #facc15; }
        .status-sakit .status-indicator { background-color: #ef4444; }
        .status-alpha .status-indicator { background-color: #9ca3af; }

        .item-selected {
            background: rgba(52, 211, 153, 0.15); /* Emerald Tint */
        }

        /* Animation Background */
        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.4;
            z-index: -1;
            pointer-events: none;
        }
        .blob-1 { top: -20%; left: -20%; width: 300px; height: 300px; background: #10b981; }
        .blob-2 { bottom: -20%; right: -20%; width: 250px; height: 250px; background: #059669; }

        /* Utilities */
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom, 20px);
        }
    </style>
</head>
<body>

    <!-- Background Blobs -->
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <main class="app-container relative overflow-hidden">
        
        <!-- HEADER: Compact & Clean -->
        <header class="flex items-center gap-4 p-4 border-b border-white/10 shrink-0 bg-black/10 backdrop-blur-md z-20">
            <img src="IAINU.jpg" alt="Logo" class="w-12 h-12 object-contain rounded-full bg-white/10" onerror="this.style.display='none'">
            <div class="flex-1">
                <h1 class="text-lg font-bold text-emerald-300 leading-tight">ABSENSI PAI 1B</h1>
                <p class="text-[10px] text-emerald-100/60 font-mono mt-0.5" id="currentDateDisplay">Loading...</p>
            </div>
            <button onclick="resetAllData()" class="bg-white/5 active:bg-red-500/20 text-xs px-3 py-2 rounded-lg border border-white/10 text-red-200 transition">
                Reset
            </button>
        </header>

        <!-- CONTENT: List Mahasiswa (Scrollable Area) -->
        <section class="flex-1 custom-scroll relative z-10" id="listSection">
            <div class="p-3 pb-24" id="nameContainer">
                <!-- Names rendered via JS -->
            </div>
        </section>

        <!-- FOOTER: Controls (Fixed Bottom) -->
        <div class="shrink-0 bg-[#022c22]/90 backdrop-blur-xl border-t border-white/10 p-3 z-30 shadow-[0_-10px_40px_rgba(0,0,0,0.5)] safe-bottom">
            
            <!-- Tab Controls -->
            <div class="flex flex-col gap-3">
                
                <!-- Row 1: Status Buttons -->
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="setStatusForSelected('Hadir')" class="hidden">Default</button> <!-- Hidden default handler -->
                    <button onclick="setStatusForSelected('Alpha')" class="py-2.5 rounded-lg bg-gray-700/50 text-gray-200 text-xs font-medium active:scale-95 transition border border-gray-600">Alpha</button>
                    <button onclick="setStatusForSelected('Izin')" class="py-2.5 rounded-lg bg-yellow-600/30 text-yellow-200 text-xs font-medium active:scale-95 transition border border-yellow-600/50">Izin</button>
                    <button onclick="setStatusForSelected('Sakit')" class="py-2.5 rounded-lg bg-red-600/30 text-red-200 text-xs font-medium active:scale-95 transition border border-red-600/50">Sakit</button>
                    <!-- Tombol Info/Reset Selection -->
                    <button onclick="clearSelection()" class="py-2.5 rounded-lg bg-emerald-900/50 text-emerald-200 text-xs border border-emerald-700 active:scale-95">
                        Clear
                    </button>
                </div>

                <!-- Row 2: Activity Input (Expandable Logic) -->
                <div class="flex gap-2 items-center bg-black/20 p-1.5 rounded-lg border border-white/5">
                    <!-- Dropdown simple untuk Activity Type -->
                    <select id="activityTypeSelector" class="bg-white/5 text-white text-[10px] py-2 px-1 rounded border-none outline-none w-20 text-center">
                        <option value="Bertanya" class="bg-gray-800">Tanya</option>
                        <option value="Menjawab" class="bg-gray-800">Jawab</option>
                        <option value="Menyanggah" class="bg-gray-800">Sanggah</option>
                    </select>

                    <input type="text" id="activityNote" class="flex-1 bg-transparent text-xs text-white placeholder-white/30 outline-none px-2" placeholder="Catatan aktivitas...">
                    
                    <button onclick="addActivityLog()" class="bg-blue-600 text-white p-2 rounded-md shadow-lg active:bg-blue-500 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                    </button>
                </div>

                <!-- Row 3: Send Button -->
                <button onclick="sendToWhatsapp()" class="w-full bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-500 hover:to-green-500 text-white font-semibold py-3 rounded-xl shadow-lg active:scale-[0.98] transition flex items-center justify-center gap-2">
                    <span>Kirim Laporan WhatsApp</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                    </svg>
                </button>
            </div>
            
            <!-- Activity Preview Mini (Hidden by default, shown if data exists) -->
            <div id="miniPreview" class="hidden mt-2 pt-2 border-t border-white/5 text-[10px] text-emerald-200/70 text-center italic">
                0 Aktivitas tercatat
            </div>
        </div>

    </main>

    <!-- Floating Toast -->
    <div id="toast" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-black/80 backdrop-blur-md border border-emerald-500/50 text-emerald-50 px-5 py-2.5 rounded-full shadow-2xl transition-all duration-300 opacity-0 translate-y-[-20px] pointer-events-none z-50 text-xs font-medium whitespace-nowrap">
        Notification
    </div>

    <script>
        // --- DATA ---
        const names = [
            "Ady Surya", "Ahmad Lubadul Fikri", "Alyvia Qurrotal ’Aini", "Anggun Lolyka Hastuti",
            "Aqillah Mazaya", "Arina Manasika", "Devi Kurniasari", "Elok Iis Nurrohmah",
            "Farikhatul Azizah", "Hanan Tsuroya Akyasi", "Hanni Hasanati", "Jembar Juli Yuasti",
            "Lusi Rahmah Oktavia", "Muhammad Hanif Fakhri", "Pniel Munandar", "Putri Dwi Astuti",
            "Riska Ayu Kesuma", "Siti Ulfatur Rohmah", "Tsabita Hasna Hanifah", "Ubaidillah Musthofa",
            "Yoana Dian Riski Astuti", "Youvischa Aulia Arsynta", "Yuyun Lutfiyatul Kh", "Zain Nur Fadilah"
        ];

        let attendanceData = {}; 
        let activityLogs = [];   
        let selectedNames = new Set();

        // --- INIT ---
        const nameContainer = document.getElementById('nameContainer');
        const dateDisplay = document.getElementById('currentDateDisplay');

        // Date
        const today = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' };
        dateDisplay.innerText = today.toLocaleDateString('id-ID', options);

        function initData() {
            names.forEach(name => attendanceData[name] = 'Hadir');
        }
        initData();

        // --- RENDER LIST ---
        function initList() {
            nameContainer.innerHTML = '';
            names.forEach((name, index) => {
                const div = document.createElement('div');
                div.id = `person-${index}`;
                // Layout Item: Relative for status bar, padding for touch
                div.className = `glass-item relative pl-4 pr-3 py-3.5 mb-2 rounded-lg flex items-center justify-between group cursor-pointer`;
                div.onclick = () => toggleSelection(name, index);
                
                div.innerHTML = `
                    <div class="status-indicator rounded-l-lg"></div> <!-- Status Bar Kiri -->
                    <div class="flex items-center gap-3 w-full">
                        <span class="text-xs font-mono opacity-40 w-5 text-right">${index + 1}</span>
                        <div class="flex flex-col">
                            <span class="text-sm font-medium text-gray-100 leading-none">${name}</span>
                            <span class="status-text text-[10px] mt-1 font-bold tracking-wide opacity-0 transition-opacity"></span>
                        </div>
                    </div>
                    <!-- Checkbox Visual -->
                    <div class="checkbox-visual w-5 h-5 rounded-full border-2 border-white/20 flex items-center justify-center transition-all">
                        <div class="w-2.5 h-2.5 bg-emerald-400 rounded-full opacity-0 transform scale-0 transition-all"></div>
                    </div>
                `;
                nameContainer.appendChild(div);
            });
            refreshAllList();
        }

        // Partial Update for Performance
        function updateListItem(index) {
            const name = names[index];
            const div = document.getElementById(`person-${index}`);
            if (!div) return;

            const status = attendanceData[name];
            const isSelected = selectedNames.has(name);
            
            // Elements
            const statusText = div.querySelector('.status-text');
            const checkboxOuter = div.querySelector('.checkbox-visual');
            const checkboxInner = checkboxOuter.querySelector('div');

            // 1. Handle Selection State
            if (isSelected) {
                div.classList.add('item-selected', 'border-emerald-500/30');
                checkboxOuter.classList.replace('border-white/20', 'border-emerald-400');
                checkboxInner.classList.remove('opacity-0', 'scale-0');
            } else {
                div.classList.remove('item-selected', 'border-emerald-500/30');
                checkboxOuter.classList.replace('border-emerald-400', 'border-white/20');
                checkboxInner.classList.add('opacity-0', 'scale-0');
            }

            // 2. Handle Status Color
            div.classList.remove('status-hadir', 'status-izin', 'status-sakit', 'status-alpha');
            let textLabel = "";
            let textColor = "";

            if (status === 'Hadir') {
                div.classList.add('status-hadir');
                // Hadir clean, no text
            } else {
                if (status === 'Alpha') { div.classList.add('status-alpha'); textLabel = "ALPHA"; textColor = "text-gray-400"; }
                if (status === 'Izin') { div.classList.add('status-izin'); textLabel = "IZIN"; textColor = "text-yellow-300"; }
                if (status === 'Sakit') { div.classList.add('status-sakit'); textLabel = "SAKIT"; textColor = "text-red-300"; }
            }

            // 3. Status Text Label
            if (textLabel) {
                statusText.innerText = textLabel;
                statusText.className = `status-text text-[10px] mt-0.5 font-bold tracking-wide opacity-100 ${textColor}`;
            } else {
                statusText.innerText = "";
                statusText.classList.add('opacity-0');
            }
        }

        function refreshAllList() {
            names.forEach((_, idx) => updateListItem(idx));
            updateMiniPreview();
        }

        // --- ACTIONS ---
        function toggleSelection(name, index) {
            if (selectedNames.has(name)) {
                selectedNames.delete(name);
            } else {
                selectedNames.add(name);
            }
            updateListItem(index);
        }

        function clearSelection() {
            const indices = [];
            selectedNames.forEach(name => {
                const idx = names.indexOf(name);
                if (idx !== -1) indices.push(idx);
            });
            selectedNames.clear();
            indices.forEach(idx => updateListItem(idx));
            showToast("Selection cleared");
        }

        function setStatusForSelected(status) {
            if (selectedNames.size === 0) {
                showToast("⚠️ Pilih nama dulu!", true);
                return;
            }

            const indices = [];
            selectedNames.forEach(name => {
                attendanceData[name] = status;
                const idx = names.indexOf(name);
                if (idx !== -1) indices.push(idx);
            });

            selectedNames.clear();
            indices.forEach(idx => updateListItem(idx));
            showToast(`Status: ${status}`);
        }

        function addActivityLog() {
            const noteInput = document.getElementById('activityNote');
            const typeSelector = document.getElementById('activityTypeSelector');
            const note = noteInput.value.trim();
            const type = typeSelector.value;

            if (selectedNames.size === 0) {
                showToast("⚠️ Pilih siswa dulu!", true);
                return;
            }
            if (!note) {
                showToast("⚠️ Ketik catatan!", true);
                return;
            }

            const indices = [];
            selectedNames.forEach(name => {
                activityLogs.push({ name, type, note });
                const idx = names.indexOf(name);
                if(idx !== -1) indices.push(idx);
            });

            noteInput.value = '';
            selectedNames.clear();
            indices.forEach(idx => updateListItem(idx));
            
            showToast("Aktivitas tersimpan");
            updateMiniPreview();
        }

        function updateMiniPreview() {
            const el = document.getElementById('miniPreview');
            if (activityLogs.length > 0) {
                el.classList.remove('hidden');
                el.innerText = `${activityLogs.length} Aktivitas tersimpan dalam antrean`;
            } else {
                el.classList.add('hidden');
            }
        }

        function resetAllData() {
            if(!confirm("Reset semua data kehadiran?")) return;
            initData();
            activityLogs = [];
            selectedNames.clear();
            refreshAllList();
            showToast("Data di-reset");
        }

        // --- WHATSAPP ---
        function sendToWhatsapp() {
            const presentList = names.filter(n => attendanceData[n] === 'Hadir');
            const absentList = names.filter(n => attendanceData[n] !== 'Hadir');
            const dateStr = dateDisplay.innerText;

            let msg = `*Daftar Kehadiran Mahasiswa PAI 1B*\n*Tanggal: ${dateStr}*\n\n`;

            // 1. Hadir
            if (presentList.length > 0) {
                presentList.forEach((n, i) => msg += `${i+1}. ${n.toUpperCase()}\n`);
            } else {
                msg += `(Tidak ada yang hadir)\n`;
            }

            // 2. Tidak Hadir
            msg += `\n*Daftar Tidak Hadir*\n`;
            if (absentList.length === 0) {
                msg += `• NIHIL\n`;
            } else {
                absentList.forEach(n => {
                    let stat = attendanceData[n];
                    if (stat === 'Alpha') stat = 'Tanpa Keterangan';
                    msg += `• ${n} (${stat})\n`;
                });
            }

            // 3. Aktivitas
            msg += `\n*Keaktifan (Bertanya, Menjawab, Menyanggah)*\n`;
            if (activityLogs.length === 0) {
                msg += `• Belum ada data.\n`;
            } else {
                activityLogs.forEach(log => {
                    msg += `• ${log.name} = ${log.type} "${log.note}"\n`;
                });
            }

            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function showToast(text, isError = false) {
            const t = document.getElementById('toast');
            t.innerText = text;
            t.className = `fixed top-20 left-1/2 transform -translate-x-1/2 px-5 py-2.5 rounded-full shadow-2xl transition-all duration-300 translate-y-0 opacity-100 pointer-events-auto z-50 text-xs font-medium whitespace-nowrap ${isError ? 'bg-red-900/90 text-red-100 border-red-500' : 'bg-black/80 text-emerald-50 border-emerald-500/50 backdrop-blur-md border'}`;
            
            setTimeout(() => {
                t.classList.add('opacity-0', 'translate-y-[-20px]');
            }, 2000);
        }

        // Start
        initList();

    </script>
</body>
</html>
